import json
import os

DATA_FILE = "data.json"
students = []

# Load data from JSON file
def load_data():
    if os.path.exists(DATA_FILE):
        with open(DATA_FILE, "r") as f:
            return json.load(f)
    return []

# Save data to JSON file
def save_data():
    with open(DATA_FILE, "w") as f:
        json.dump(students, f, indent=2)

# Search for a student by roll number
def search(roll):
    for s in students:
        if s['roll_no'] == roll:
            return s
    return None

# Add a student
def add_student():
    roll = input("Roll no: ").strip()
    if any(s['roll_no'] == roll for s in students):
        print("❌ Roll no already exists.")
        return
    name = input("Name: ").strip()
    grade = input("Grade: ").strip()
    age = input("Age (optional): ").strip()
    student = {"roll_no": roll, "name": name, "grade": grade}
    if age:
        student["age"] = age
    students.append(student)
    print("✅ Student added.")

# View all students
def view_students():
    if not students:
        print("📭 No records found.")
        return
    print(f"{'Roll':<10}{'Name':<20}{'Grade':<10}{'Age':<5}")
    for s in students:
        age = s.get("age", "-")
        print(f"{s['roll_no']:<10}{s['name']:<20}{s['grade']:<10}{age:<5}")

# Update a student
def update_student():
    roll = input("Roll to update: ").strip()
    s = search(roll)
    if not s:
        print("❌ Student not found.")
        return
    new_name = input(f"Name [{s['name']}]: ").strip()
    if new_name:
        s['name'] = new_name
    new_grade = input(f"Grade [{s['grade']}]: ").strip()
    if new_grade:
        s['grade'] = new_grade
    new_age = input(f"Age [{s.get('age', '')}]: ").strip()
    if new_age:
        s['age'] = new_age
    print("✅ Student updated.")

# Delete a student
def delete_student():
    roll = input("Roll to delete: ").strip()
    s = search(roll)
    if not s:
        print("❌ Student not found.")
        return
    if input("Are you sure you want to delete? (y/N): ").lower() == 'y':
        students.remove(s)
        print("🗑️ Student deleted.")
    else:
        print("Cancelled.")

# Main menu loop
def main():
    global students
    students = load_data()
    while True:
        print("\n🔸 Student Management System 🔸")
        print("1) Add\n2) View\n3) Search\n4) Update\n5) Delete\n6) Exit")
        choice = input("Enter your choice: ").strip()
        if choice == "1":
            add_student()
        elif choice == "2":
            view_students()
        elif choice == "3":
            roll = input("Enter roll number to search: ").strip()
            s = search(roll)
            if s:
                print(f"✅ Found: {s}")
            else:
                print("❌ Student not found.")
        elif choice == "4":
            update_student()
        elif choice == "5":
            delete_student()
        elif choice == "6":
            save_data()
            print("💾 Data saved. Exiting...")
            break
        else:
            print("❌ Invalid choice. Try again.")

if _name_ == "_main_":
    main()
